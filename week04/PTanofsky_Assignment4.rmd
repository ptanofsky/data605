---
title: 'DATA 605: Assignment 04'
subtitle: 'EigenShoes'
author: "Philip Tanofsky"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: pdf_document
---

# EigenShoes

Starting point: https://rpubs.com/R-Minator/eigenshoes

```{r}
# Libraries
library(jpeg)
library(ramify)
```

## Use of Graphics

Add graphics to the data set.

```{r}
# Prepare for Image Processing
num <- 17
files <- list.files("/Users/philiptanofsky/Documents/School/CUNY/MSDS/Courses/DATA605/Week04/jpg/", pattern="\\.jpg")[1:num]

files
```

## View Shoes Function

```{r}
# Set Adjustment Parameters
height <- 1200
width <- 2500
scale <- 20

plot_jpeg <- function(path, add=FALSE) {
  
  jpg <- readJPEG(path, native=T) # Read the file
  res <- dim(jpg)[2:1] # Get the resolution, [x, y]
  if (!add) { # Initialize any empty plot are if add == False
    plot(1, 1, xlim=c(1, res[1]), ylim=c(1, res[2]), asp=1, type='n', 
         xaxs='i', yaxs='i', xaxt='n', yaxt='n', xlab='', bty='n')
    rasterImage(jpg, 1, 1, res[1], res[2])
  }
}
```

## Load the Data into an Array

```{r}
im <- array(rep(0, length(files) * height/scale * width/scale * 3), dim=c(length(files), height/scale, width/scale, 3))

for (i in 1:num) {
  temp <- resize(readJPEG(paste0("/Users/philiptanofsky/Documents/School/CUNY/MSDS/Courses/DATA605/Week04/jpg/", files[i])), height/scale, width/scale)
  im[i,,,] <- array(temp, dim=c(1, height/scale, width/scale, 3))
}
```

## Vectorize

```{r}
flat <- matrix(0, num, prod(dim(im)))

for (i in 1:num) {
  newim <- readJPEG(paste0("/Users/philiptanofsky/Documents/School/CUNY/MSDS/Courses/DATA605/Week04/jpg/", files[i]))
  r <- as.vector(im[i,,,1])
  g <- as.vector(im[i,,,2])
  b <- as.vector(im[i,,,3])
  flat[i,] <- t(c(r, g, b))
}
shoes <- as.data.frame(t(flat))
```

## Actual Plots

NOT SHOWING UP, PLEASE CHECK THIS CODE BELOW

```{r}
# Old Shoes
par(mfrow=c(3,3))
par(mai=c(.3, .3, .3, .3))
for (i in 1:num) { # plot the first images only
  plot_jpeg(writeJPEG(im[i,,,]))
}
```

## Get Eigen components from correlation structure

```{r}
scaled <- scale(shoes, center=TRUE, scale=TRUE)
mean.shoe <- attr(scaled, "scaled:center") # saving for classification
std.shoe <- attr(scaled, "scaled:scale") # saving for classification ... later
```

## Calculate Covariance (Correlation)

```{r}
sigma_ <- cor(scaled)

sigma_
```

## Get the eigencomponents

```{r eval=F}
myeigen <- eigen(sigma_)
cumsum(myeigen$values) / sum(myeigen$values)
```

## Eigen shoes

```{r eval=F}
scaling <- diag(myeigen$values[1:5]^(-1/2)) / (sqrt(nrow(scaled)-1))
eigenshoes <- scaled %*% myeigen$vectors[,1:5] %*% scaling
imageShow(array(eigenshoes[,1], c(60, 125, 3)))
```

## Generate Principal Components

Transform the images

```{r eval=F}
# Generate variables
height <- 1200
width <- 2500
scale <- 20
newdata <- im
dim(newdata) <- c(length(files), height*width*3/scale^2)
mypca <- princomp(t(as.matrix(newdata)), scores=TRUE, cor=TRUE)
```

## Eigenshoes

Generate Eigenshoes

```{r eval=F}
mypca2 <- t(mypca$scores)
dim(mypca2) <- c(length(files), height/scale, width/scale, 3)
par(mfrow=c(5,5))
par(mai=c(.001, .001, .001, .001))
# Plot the first 20 eigenshoes only
for (i in 1:20) {
  plot_jpeg(writeJPEG(mypca2[i,,,], bg="white")) # Complete without reduction
}
```

## Variance Capture

```{r eval=F}
a <- round(mypca$sdev[1:num]^2 / sum(mypca$sdev^2), 3)
cumsum(a)
```





